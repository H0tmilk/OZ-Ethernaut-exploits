## 16. Preservation
The preservation challenge contains two contracts : the main one, *Preservation*, and the library *LibraryContract*. These contracts, when used together, contains a breach in the state variables declarations.

As described in [the documentation](https://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html), state variables a stored in a compact way and *the layout of the declarations matters*, especially when using *delegatecall* for a library call.

We can see that the library contains only one state variable (`uint storedTime;`), when the *Preservation* contract which calls it with *delegatecall* has 5 state variables declarations. As *delegatecall* is preserving the context of the caller, when the *setTime(uint time)* is called, `storedTime = _time;` will not change *Preservation*'s *storedTime* state varible but the value of the first state variable : *timeZone1Library*.

Using this breach, we can modify the *timeZone1Library* address with a malicious smart contract to modify the owner later.

1. Modify *timeZone1Library* by sending it in parameter to *setFirstTime(uint _timeStamp)*:

![Preservation timeZone1Library edit](https://i.imgur.com/X8sSI2l.png)

![Preservation timeZone1Library changed](https://i.imgur.com/Wv5Ywvx.png)

2. Then, we can use our malicious contract to change the owner by calling *setFirstTime(uint _timeStamp)* with *1* any other parameter :

![Preservation owner changed](https://i.imgur.com/51Oywo3.png)

Note that our attached malicious contract is able to change the owner of *Preservation* because it keeps the **same layout** for state variables.